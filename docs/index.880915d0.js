/* @license
 * RAMS <https://jacobxperez.github.io/rams/>
 * Copyright (C) 2025 Jacob Perez <jacobxperez@gmx.com>
 * Licensed under the Apache License, Version 2.0
 * http://www.apache.org/licenses/LICENSE-2.0
-----------------------------------------------------------------------------*/
class e{constructor(e,t,n={}){this.validate=Array.isArray(e)?e:[e],this.initialValue=t,this.value=null,this.pending=!1,this.lastError=null,this.label=n.label||"Value",this.listeners=new Set,this.errorListeners=new Set,arguments.length>=2&&this.set(t)}async runValidation(e){for(const t of this.validate){const n="string"==typeof t?"type":"custom",r="function"==typeof t?t.name||"anonymous":t;try{if("type"===n){if(typeof e!==t)throw new TypeError(`${this.label} must be of type '${t}', got '${typeof e}'`)}else{const n=t(e),r=n instanceof Promise?await n:n;if(!0!==r&&void 0!==r){const e="string"==typeof r?`${this.label} ${r}`:`${this.label} failed validation`;throw new TypeError(e)}}}catch(t){throw this.lastError={message:t.message,type:n,source:r,value:e,timestamp:Date.now()},this.emitError(this.lastError),t}}return e}set(e){this.lastError=null,this.pending=!0;if(this.validate.some((t=>{if("function"!=typeof t)return!1;try{return t(e)instanceof Promise}catch{return!1}})))return this._setAsync(e);try{for(const t of this.validate)if("string"==typeof t){if(typeof e!==t)throw new TypeError(`${this.label} must be of type '${t}', got '${typeof e}'`)}else{const n=t(e);if(!0!==n&&void 0!==n){const e="string"==typeof n?`${this.label} ${n}`:`${this.label} failed validation`;throw new TypeError(e)}}return this.value=e,this.pending=!1,this.emit(e),!0}catch(t){throw this.pending=!1,this.lastError={message:t.message,type:"string"==typeof validator?"type":"custom",source:validator,value:e,timestamp:Date.now()},this.emitError(this.lastError),t}}async _setAsync(e){return this.pending=!0,this.lastError=null,this.runValidation(e).then((e=>(this.value=e,this.pending=!1,this.emit(e),!0))).catch((e=>{throw this.pending=!1,console.error("[DataManager]",e.message),e}))}async validate(){this.pending=!0,this.lastError=null;try{return await this.runValidation(this.value),this.pending=!1,!0}catch{return this.pending=!1,!1}}get(){return"object"==typeof globalThis.currentEffect&&globalThis.currentEffect.deps.add(this),this.value}freeze(){return null!==this.value&&"object"==typeof this.value&&(this.value=freezeDeep(this.value)),this}unfreeze(){return null!==this.value&&"object"==typeof this.value&&(this.value=unfreezeDeep(this.value)),this}getError(){return this.lastError}getErrorReport(){if(!this.lastError)return null;const{message:e,type:t,source:n,value:r,timestamp:i}=this.lastError;return{label:this.label,message:e,type:t,source:n,value:r,timestamp:new Date(i).toLocaleString(),rawTimestamp:i}}isValid(){return null===this.lastError}isPending(){return this.pending}isDirty(){return this.value!==this.initialValue}reset(){this.set(this.initialValue)}onChange(e){return"function"==typeof e&&this.listeners.add(e),()=>this.listeners.delete(e)}onError(e){return"function"==typeof e&&this.errorListeners.add(e),()=>this.errorListeners.delete(e)}emit(e){if(this.listeners.forEach((t=>t(e))),this._effectListeners)for(const e of this._effectListeners)e()}emitError(e){this.errorListeners.forEach((t=>t(e)))}}const t=(...e)=>t=>!!e.some((e=>t instanceof e)),n=e=>t=>!!(void 0===t||e&&e(t)),r=(...e)=>t=>!!e.includes(typeof t),i=e=>!!t(Element,Document,DocumentFragment)(e)||(console.error("Must be a instance of Element, Document, DocumentFragment but received",typeof e),!1),o=e=>!(!r("string")(e)||""===e.trim()),a=e=>!!r("string")(e),s=(...e)=>(...t)=>e.length===t.length&&e.every(((e,n)=>e(t[n]))),l=(e,t)=>s(i,o)(e,t),c=e=>n(a)(e),d=new e(i),u=new e(o),h=new e(n(a));function f(e,t){return t?`[data-${e}="${t}"]`:`[data-${e}]`}const m=e=>(t,n)=>{if(l(e,t)){if(!e.hasAttribute(`data-${t}`))return!1;if(null===n)return!0;if(!a(n)&&null!==n)return!1;const r=e.getAttribute(`data-${t}`);return!!r&&r.trim().split(/\s+/).includes(n)}return!1},p=e=>(t,n)=>(d.set(e),u.set(t),h.set(n),d.get().closest(f(u.get(),h.get()))),g=e=>(t,n)=>r=>{if(l(e,t)&&c(n)&&c(r)){const i=e.getAttribute(`data-${t}`)===n?r:n;return e.setAttribute(`data-${t}`,i),i}return!1},y=(...e)=>{const t=new Set,n=new Set(["pop","tooltip",...e]);function r(){t.forEach((e=>{n.has(e.dataset.toggle)&&m(e)("state","active")&&g(e)("state","active")("inactive")}))}function i(e){const t=p(e)("dropbox"),n=m(e)("state","active");t||n||r(),g(e)("state","active")("inactive")}document.addEventListener("click",(e=>{const n=p(e.target)("toggle");if(n){if(n){if(t.has(n))return;t.add(n),n.addEventListener("click",(e=>{i(n),e.stopPropagation()}),!0),i(n)}else r();e.stopPropagation()}else r()}))};const E=new class{#e=!1;#t=null;constructor(){this.createEffect=this.createEffect.bind(this),this.data=new e,this.toggle=y,this.#n()}#n(){this.#e||(this.#t={deps:new Set},this.#e=!0)}data(t,n,r={}){const i=new e(t,n,r);return i.get=()=>(this.#t&&this.#t.deps.add(i),i.value),i}createEffect(e,t={}){const n=new Set,r=[],i=()=>{for(const e of n)e._effectListeners?.delete(i);n.clear(),this.#t={deps:n};const t=e();this.#t=null;for(const e of n)e._effectListeners||(e._effectListeners=new Set),e._effectListeners.add(i);r.forEach((e=>e())),r.length=0,"function"==typeof t&&r.push(t)};return t.lazy||i(),{stop(){for(const e of n)e._effectListeners?.delete(i);r.forEach((e=>e()))}}}clear(){this.#t=null,this.#e=!1}},v=()=>{const e=document.getElementById("aside"),t=document.getElementById("content");if("post"===meta.type){const n=t.querySelectorAll("h1, h2, h3, h4, h5, h6"),r='\n                <ul id=\'contents\' data-display="small-none">\n                    <li>\n                        <p><strong>Contents</strong></p>\n                    </li>\n                </ul>\n    \n                <ul data-display="small" data-box="border">\n                    <li>\n                        <a data-anchor data-flex data-toggle>\n                            <strong data-item="grow">Contents</strong>\n                            <span data-icon="&#xe043;"></span>\n                        </a>\n    \n                        <ul id=\'contentsDropdown\' data-dropbox>\n                        </ul>\n                    </li>\n                </ul>';e.insertAdjacentHTML("beforeend",r),n.forEach(((e,t)=>{e.setAttribute("id",`${t}`);const n=e.innerText,r=`<li><a href="#${t}">${n}</a></li>`;document.getElementById("contents").insertAdjacentHTML("beforeend",r);const i=`<li><a href="#${t}" data-anchor="menu">${n}</a></li>`;document.getElementById("contentsDropdown").insertAdjacentHTML("beforeend",i)}))}},w={_string(e,t){const n=e.trim(),r=document.querySelector(t);r?r.insertAdjacentHTML("beforeend",n):console.error(`Error: Target element "${t}" not found.`)},_append(e,t,n){if(!e||!t||!n)return void console.error("Error: Invalid arguments in _append().");const r=e.querySelector(t);if(!r)return void console.error(`Error: Template "${t}" not found.`);const i=r.content.cloneNode(!0),o=document.querySelector(n);o?o.appendChild(i):console.error(`Error: Target element "${n}" not found.`)},parser(e,t="text/html"){try{const n=(new DOMParser).parseFromString(e,t);if(!n)throw new Error("Parsing resulted in a null document.");return n}catch(e){return console.error(`Error parsing string: ${e.message}`),null}},create(e,t,n="body"){if("string"!=typeof e||!t)return console.error("Error: Invalid HTML string or missing ID."),null;const r=document.createElement("template");r.innerHTML=e.trim(),r.setAttribute("id",t);const i=document.querySelector(n);return i?(i.appendChild(r),r):(console.error(`Error: Parent element "${n}" not found.`),null)},async string(e,t){try{await new Promise(((t,n)=>{"string"!=typeof e?n("Error: Source is not a string."):t()})),this._string(e,t)}catch(e){return console.error(e)}},async append(e,t){try{await new Promise(((t,n)=>{e||n("Error: Template selector is required."),t()})),this._append(document,e,t)}catch(e){return console.error(e)}},async fetch(e,t=null){try{const n=await fetch(e);if(!n.ok)throw new Error(`HTTP Error: ${n.status}`);const r=await n.text(),i=this.parser(r);if(!i)return;if(t){const e=i.querySelector(t);e&&!document.getElementById(e.id)?document.body.appendChild(e):console.warn(`Warning: No new template found for "${t}".`)}else i.querySelectorAll("template").forEach((e=>{document.getElementById(e.id)||document.body.appendChild(e)}))}catch(e){console.error(`Fetch error: ${e.message}`)}},removeAll(){document.querySelectorAll("template").forEach((e=>e.remove()))}};document.addEventListener("DOMContentLoaded",(()=>{""===meta.title?meta.title="<h1>RAMS</h1>":meta.title=`<h1>${meta.title}</h1>`;let e,t=`\n        <div id="header" data-container>\n            ${meta.title}\n        </div>\n        `,n='\n        <div data-container data-grid="main">\n            <aside id="aside" data-column="large-3 medium-3 small-4"></aside>\n            <article id="content" data-column="large-9 medium-9 small-4"></article>\n        </div>\n        ';"fullPage"===meta.type&&(n='\n        <div id="content" data-container data-grid="main"></div>\n        '),e="localhost"===location.hostname||"127.0.0.1"===location.hostname?window.location.origin+"/templates/index.59811f9a.html":window.location.origin+"/rams/templates/index.19081ad0.html",w.string(`\n        <nav data-navbar="top"></nav>\n        <header data-section="header">\n            ${t}\n        </header>\n        <main data-section="main">\n            ${n}\n        </main>\n        <footer data-section="footer"></footer>\n        `,"body").then((()=>w.append("#headerTemplate","#header"))).then((()=>w.append("#contentTemplate","#content"))).then((()=>v())).then((()=>w.fetch(e))).then((()=>{w.append("#navTemplate","nav"),w.append("#footerTemplate","body > footer")})).finally((()=>w.removeAll())),E.toggle()}));